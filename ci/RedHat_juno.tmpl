#!/bin/bash
set -x

# add openstack juno repo
yum install yum-plugin-priorities -y
yum install http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-5.noarch.rpm -y  
yum install http://rdo.fedorapeople.org/openstack-juno/rdo-release-juno.rpm -y 

# modify centos7 repo for workaround
sed -i 's/epel-Derived from Red Hat Enterprise Linux 7.1 (Source)/epel-7/g' /etc/yum.repos.d/rdo-release.repo

# add galeracluster repo 
cat <<EOF >/etc/yum.repos.d/galera-cluster.repo
[galera-cluster]
name=galera cluster repository
baseurl=http://releases.galeracluster.com/centos/7/x86_64/
enabled=1
skip_if_unavailable=0
gpgcheck=1
gpgkey=http://releases.galeracluster.com/GPG-KEY-galeracluster.com
EOF

yum update -y
yum install createrepo -y
yum install tar -y

#download packages
#set packages = $getVar('packages', [])

#for pkg in $packages
yum -y install $pkg --downloadonly
#end for

#make repo

mkdir -p /centos7-juno-ppa/{Packages,repodata}

find /var/cache/yum/ -name *.rpm | xargs -i cp {} /centos7-juno-ppa/Packages/

cp /centos7-comps.xml /centos7-juno-ppa/
createrepo -g centos7-comps.xml /centos7-juno-ppa 
tar -zcvf /centos7-juno-ppa.tar.gz /centos7-juno-ppa


